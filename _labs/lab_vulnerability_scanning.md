---
title: "Lab: Vulnerability Scanning"
number: 6
vms:
    - Kali
    - Metasploitable2
description: exploration via nmap and nessus
published: true
---


<div class='alert alert-warning'>Ensure that you can <code>ping</code> Metasploitable2 from Kali, and Kali from Metasploitable2, before continuing the lab.
Use the addresses shown in the <a href='{{'/labs/virtual-machines#infosec-net-network-map' | relative_url }}'>infosec-net network map</a>.</div>

# Objective

The objective of this lab is to create a report of potential vulnerabilities for a virtual machine. The deliverable for this lab is your report and this document with your answers to questions below (submitted on D2L).
The VM is a Ubuntu-based Linux distribution called MetaSploitable2, which is specifically designed to teach penetration testing skills such as vulnerability scanning.


# Part 1. Host Discovery and Scanning using NMAP

NMAP is the de facto standard of host discovery and port scanning and has a host of features that make the tool very robust. In this section of the lab, you’ll try a few of NMAP’s features.

<div class='alert alert-info'>Throughout the lab, you should replace <code>&lt;IP.addr.of.metasploitable2&gt;</code> with the actual IPv4 address of Metasploitable.</div>

1.	Open a "Terminal Emulator" window in Kali.
2.	Run `nmap`. Take a quick look at the available options.
3.	Use `nmap` to determine whether the your Metasploitable2 VM is live using a "ping scan":

        nmap -sn <IP.addr.of.metasploitable2>

    The ping scan not only sends an ICMP request, but also an ARP ping, TCP pinging, and other techniques to determine if a host is live on the network.

    {% include lab_question.html question="What kind of information is shown when you run this ping scan for Metasploitable2?" %}

    You can also scan a range of IPs using [CIDR block notation](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation).
	See the [network map]({{ "/virtual-machines#infosec-net-network-map" | relative_url }}) for the ipv4 block of the infosec-net network.
    This can be fun to do if you also have your vulnerable Windows 7 vm running at the same time, although this is not required.

        nmap -sn <ipv4 CIDR block>

	You can know your network by typing `ifconfig` on either Kali or Metasploitable2, and looking for the `inet` address plus the `mask` value on the same line.
	For example, a "mask" of `255.255.255.0` applied to an "inet" address of 192.168.56.17 translates to a network of 192.168.56.0/24.
    (Where 24 is the number of bits to mask and it takes 8 bits to make 255, 8x3=24, so that would mask three of the '.' blocks.)


5.	Once you determine that a host is live, you can use NMAP to scan for open ports. Use a TCP scan to determine which ports are open on Metasploitable2:

        nmap -sS <IP.addr.of.metasploitable2>

    This scans approximately 1,800 of the most common TCP ports on the target machine.

    {% include lab_question.html question="Which ports are open on the Metasploitable2 VM?" %}



6.	You can also specify additional ports to scan. Scan the first 10,000 ports of the Metasploitable2 VM:

        nmap -sS -p1-10000 <IP.addr.of.metasploitable2>

    {% include lab_question.html question="Did you find any additional ports?" %}



7.	Nmap can provide additional information about open ports by interrogating the ports it finds using the “sV” flag:

        nmap -sV <IP.addr.of.metasploitable2>

    **Note:** Press the “enter” key to see a status of the NMAP scan.



8.	You can get further information still by using the advanced flag (“-A”).

        nmap -sV -A <IP.addr.of.metasploitable2>

    {% include lab_question.html question="What additional information about the open ports on Metasploitable2 were you able to obtain by using the -sV and -A flags?" %}




9.	A useful feature of nmap is operating system fingerprinting which it accomplishes by profiling how a system responds to its scans.

        nmap -O <IP.addr.of.metasploitable2>

    **Note:** That’s a capital “oh” not a “zero.”

    {% include lab_question.html question="What operating system does nmap report Metasploitable2 to be? " %}


10.	Now scan for web applications on Metasploitable2. Increasingly, applications run off of a different URL, all using port 80. Other `http`-protocol apps may run off of non-80 ports.

        nmap -sV --script=http-enum <IP.addr.of.metasploitable2>

    {% include lab_question.html question="What web applications are available on Metasploitable2?" %}




# Part 2. Nessus


## Start and register the Nessus Scanner

1.  Start the nessus daemon

        service nessusd start

    The `d` in `nessusd` stands for 'daemon'.

1.  Open Firefox and browse to `https://kali:8834`. Click 'Advanced' > 'Add Security Exception' > 'Confirm Security Exception' to get past the SSL warning.

1.  Select "Nessus Essentials"

1.  Get a registration activation code by entering an email address.

5.	Choose any `username:password` you prefer for use with nessus. For instance, you could use user `root` password `toor` when prompted by Nessus. Click “reload” if the page fails to load.


## Run Nessus Scans

6.	Click the “Policies” tab and press the “New Policy” button.

    1.	Choose “Basic Network Scan”

    2.	Name the policy “Metasploitable2 Scan”

    3.	Under the category “Discovery,” change the “Scan Type” to “All ports.”

	1.	Under “Assessment”, change the dropdown to "Scan for known web vulnerabilities."

    1.	Under “Advanced”, select Scan Type "Custom". Then select “General” on the left. Uncheck “Enable safe checks.”

	1. 	Save your new custom policy.

7.  Click the "Scans" tab and press the "New Scan" button.

    1. Select the "User Defined" tab. Choose your Custom policy.

    1. In the “Name” field, enter "Metasploitable2" or something more cool-sounding. In the “Targets” field, enter the IP address of the MetaSploitable2 VM.

    1. Click the “Save” button, then click the “Scans” tab at the top of the web page. Next, on row of the Metasploitable2 scan you just created, click the triangle "play" symbol to launch the scan <i class='fa fa-rocket'></i>.

    {% if site.instructorcollab_username == 'jdarcy' %}
        1. Fist-bump your neighbor <i class='fa fa-hand-rock-o'></i> while Nessus starts throwing rocks at windows.
    {% endif %}

8.  In the Scans tab you should see the scan job running. This should take about 10 minutes to complete. In the meantime, you can click the job to see the vulnerabilities that Nessus has found so far. Vulnerabilities can be sorted by severity.



{% include lab_question.html question="Do you think it would be difficult to compromise this system? Explain." %}

{% include lab_question.html question="Which vulnerabilities are critical? Of these, which appear to be most serious? Double-click a vulnerability in the report and read the description." %}

<div class='alert alert-success'><strong>Consider:</strong> What would be the first thing you would do to secure this system?</div>
